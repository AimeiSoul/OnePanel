<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>OnePanel - 管理员控制台</title>
    <link rel="stylesheet" href="/static/css/admin_style.css">
    <script src="/static/js/admin.js"></script>
    <link rel="icon" type="image/svg+xml" href="/static/logo.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
</head>

<body>
    <div class="admin-screen">
        <div class="admin-container">
            <aside class="admin-sidebar">
                <div class="brand">
                    <img src="/static/logo.svg" alt="logo"
                        style="width: 28px; filter: drop-shadow(0 0 5px var(--admin-primary));">
                    <h2>OnePanel</h2>
                </div>

                <nav class="admin-nav">
                    <button id="nav-settings" class="active" onclick="switchTab('settings')">
                        <span class="nav-icon">⚙️</span> 系统设置
                    </button>
                    <button id="nav-links" onclick="switchTab('links')">
                        <span class="nav-icon">🔗</span> 全局链接
                    </button>
                    <button id="nav-users" onclick="switchTab('users')">
                        <span class="nav-icon">👥</span> 用户管理
                    </button>
                    <button class="nav-icons" onclick="switchTab('icons')">
                        <span class="nav-icon">🖼️</span> 图标清理
                    </button>
                    <button class="nav-custom" onclick="switchTab('custom')">
                        <span class="nav-icon">💻</span> 自定义代码
                    </button>
                </nav>

                <div class="sidebar-footer">
                    <button class="logout-btn" onclick="adminLogout()">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M16 17v-3H9v-4h7V7l5 5-5 5M14 2a2 2 0 012 2v2h-2V4H5v16h9v-2h2v2a2 2 0 01-2 2H5a2 2 0 01-2-2V4a2 2 0 012-2h9z" />
                        </svg>
                        <span>退出系统</span>
                    </button>

                    <div class="sidebar-copyright">
                        Powered by <a href="https://github.com/AimeiSoul/OnePanel" target="_blank">OnePanel</a>
                    </div>
                </div>
            </aside>

            <main class="main-content">

                <div id="tab-settings" class="content-section">
                    <div class="content-header">
                        <h1>系统设置</h1>
                    </div>

                    <div class="settings-grid-layout">
                        <div class="admin-card section-card">
                            <div class="card-header">
                                <span class="card-icon">🏠</span>
                                <h3>站点基础信息</h3>
                            </div>
                            <div class="card-body">
                                <div class="input-group">
                                    <label>站点标题 (Title)</label>
                                    <input type="text" id="site-title" class="admin-input"
                                        placeholder="OnePanel | 导航面板">
                                </div>
                                <div class="input-group" style="margin-top: 20px;">
                                    <label>图标 API (Favicon API)</label>
                                    <input type="text" id="favicon-api" class="admin-input"
                                        placeholder="https://favicon.link/${hostname}">
                                </div>
                                <button class="admin-btn" onclick="saveSiteInfo()"
                                    style="margin-top: 25px; width: 100%;">
                                    保存基础信息
                                </button>
                            </div>
                        </div>

                        <div class="admin-card section-card">
                            <div class="card-header">
                                <span class="card-icon">🛡️</span>
                                <h3>策略控制</h3>
                            </div>
                            <div class="card-body">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <h4>开放用户注册</h4>
                                        <p>允许新用户创建账号</p>
                                    </div>
                                    <label class="switch-container">
                                        <input type="checkbox" id="reg-switch" onchange="updateRegStatus(this.checked)">
                                        <span class="switch-slider"></span>
                                    </label>
                                </div>

                                <div class="setting-item" style="margin-top: 15px;">
                                    <div class="setting-info">
                                        <h4>风险关键词管理</h4>
                                        <p>配置用于链接合规检测的敏感词库</p>
                                    </div>
                                    <button class="admin-btn-mini" onclick="openRiskModal()"
                                        style="padding: 6px 15px;">管理</button>
                                </div>

                                <div class="setting-item disabled" style="margin-top: 15px;">
                                    <div class="setting-info">
                                        <h4>其他功能</h4>
                                        <p>其他功能暂无规划，欢迎提出</p>
                                    </div>
                                    <span class="badge-mini">暂无规划</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="admin-card section-card" style="margin-top: 25px;">
                        <div class="card-header">
                            <span class="card-icon">🎨</span>
                            <h3>资源替换 (覆盖默认图片)</h3>
                        </div>
                        <div class="card-body">
                            <div class="asset-grid">
                                <div class="asset-card">
                                    <div class="asset-preview">🖼️</div>
                                    <div class="asset-info">
                                        <p class="asset-name">全局背景</p>
                                        <p class="asset-desc">default_bg.jpg</p>
                                    </div>
                                    <button class="admin-btn-mini" onclick="triggerUpload('background')">上传</button>
                                </div>
                                <div class="asset-card">
                                    <div class="asset-preview">🔗</div>
                                    <div class="asset-info">
                                        <p class="asset-name">默认链接图</p>
                                        <p class="asset-desc">default_link.jpg</p>
                                    </div>
                                    <button class="admin-btn-mini" onclick="triggerUpload('default_link')">上传</button>
                                </div>
                                <div class="asset-card">
                                    <div class="asset-preview">⚠️</div>
                                    <div class="asset-info">
                                        <p class="asset-name">错误占位图</p>
                                        <p class="asset-desc">default_error.jpg</p>
                                    </div>
                                    <button class="admin-btn-mini" onclick="triggerUpload('default_error')">上传</button>
                                </div>
                            </div>
                            <input type="file" id="asset-file-input" style="display: none;"
                                onchange="handleAssetUpload(this)">
                        </div>
                    </div>
                </div>

                <div id="tab-users" class="content-section" style="display: none;">
                    <div class="content-header"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <h1>用户管理</h1>
                        <div style="position: relative; width: 300px;">
                            <input type="text" id="user-search" class="admin-input" placeholder="🔍 搜索用户名..."
                                oninput="performUserSearch()">
                        </div>
                    </div>
                    <div class="admin-card data-table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>用户名</th>
                                    <th>角色</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="user-list-body">
                            </tbody>
                        </table>
                        <div class="pagination-container">
                            <div class="pagination-info">共 <span id="user-total-count">0</span> 个用户</div>
                            <div class="pagination-controls">
                                <button id="user-btn-prev">上一页</button>
                                <div id="user-page-numbers" class="page-numbers-box"></div>
                                <button id="user-btn-next">下一页</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-links" class="content-section" style="display: none;">
                    <div class="content-header"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <h1>全局链接</h1>
                        <div style="position: relative; width: 300px;">
                            <input type="text" id="link-search" class="admin-input" placeholder="🔍 搜索名称和网址..."
                                oninput="performLinkSearch()">
                        </div>
                    </div>
                    <div class="admin-card data-table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th style="width: 20%;">网站名称</th>
                                    <th style="width: 35%;">网址 (URL)</th>
                                    <th style="width: 15%;">上传用户</th>
                                    <th style="width: 15%;">合规性参考</th>
                                    <th style="width: 15%;">安全核查</th>
                                </tr>
                            </thead>
                            <tbody id="link-list-body"></tbody>
                        </table>
                        <div class="pagination-container">
                            <div class="pagination-info">共 <span id="link-total-count">0</span> 条记录</div>
                            <div class="pagination-controls">
                                <button id="link-btn-prev">上一页</button>
                                <div id="link-page-numbers" class="page-numbers-box"></div>
                                <button id="link-btn-next">下一页</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-icons" class="content-section" style="display: none;">
                    <div class="content-header"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <h1>图标清理</h1>
                        <button class="admin-btn-mini" onclick="clearAllUnusedIcons()"
                            style="background: #ff4757; border-color: #ff4757;">
                            🗑️ 一键清空冗余
                        </button>
                    </div>

                    <div class="admin-card section-card">
                        <div class="card-body">
                            <p class="hint-text" style="margin-bottom: 20px; color: rgba(255,255,255,0.5);">
                                提示：以下图标存在于服务器目录中，但未绑定到任何现有链接。这通常是因为上传后未保存或链接已被删除导致的。
                            </p>

                            <div id="unused-icons-grid" class="asset-grid">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-custom" class="content-section" style="display: none;">

                    <div class="admin-card">
                        <div class="card-header">
                            <h3>🎨 全局样式 (CSS)</h3>
                        </div>
                        <textarea id="css-editor"></textarea>
                    </div>

                    <div class="admin-card" style="margin-top: 20px;">
                        <div class="card-header">
                            <h3>⚡ 全局脚本 (JS)</h3>
                        </div>
                        <textarea id="js-editor"></textarea>
                    </div>

                    <div class="admin-actions" style="margin-top: 20px;">
                        <button class="admin-btn" onclick="saveCustomCode()" style="width: 100%; height: 45px;">
                            🚀 保存设置
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div id="toast-container"
        style="position: fixed; top: 30px; right: 30px; z-index: 9999; display: flex; flex-direction: column; gap: 10px;">
    </div>

    <div id="custom-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title">确认操作</h3>
            <p id="modal-message">你确定要执行此操作吗？</p>
            <div id="modal-input-container" style="display: none;">
                <input type="text" id="modal-input" class="admin-input">
            </div>
            <div class="modal-footer">
                <button id="modal-cancel-btn">取消</button>
                <button id="modal-confirm-btn">确定</button>
            </div>
        </div>
    </div>

    <div id="risk-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="card-header">
                <span class="card-icon">🛡️</span>
                <h3>策略控制中心</h3>
            </div>
            <div class="card-body">
                <p>请输入风险关键词，使用英文逗号 (,) 分隔。命中词库的链接在管理端将标记为红色警示。</p>

                <div id="modal-input-container">
                    <textarea id="risk-keywords-input" placeholder="例如: 赌博,色情,vpn..."
                        style="width: 100%; min-height: 150px;"></textarea>
                </div>

                <div class="modal-footer">
                    <button onclick="closeRiskModal()">取消</button>
                    <button onclick="saveRiskKeywords()"
                        style="background: var(--admin-primary); color: #fff;">确认覆盖</button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>